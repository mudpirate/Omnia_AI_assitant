generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextIndex", "fullTextSearchPostgres", "postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [pg_trgm, vector]
}

model Product {
  id                   String                 @id @default(cuid())
  storeName            StoreName
  title                String
  description          String?
  searchKey            String
  descriptionEmbedding Unsupported("vector")?
  specs                Json?
  category             String
  price                Float
  stock                StockStatus            @default(IN_STOCK)
  brand                String
  imageUrl             String                 @default("https://example.com/placeholder.png")
  productUrl           String                 @default("https://example.com/placeholder-url")
  scrapedAt            DateTime               @default(now())
  lastSeenAt           DateTime               @updatedAt
  couponId             String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  coupon               Coupon?                @relation(fields: [couponId], references: [id])

  @@unique([storeName, productUrl], map: "uniq_store_producturl")
  @@index([storeName], map: "idx_store")
  @@index([price], map: "idx_price")
  @@index([category], map: "idx_category")
  @@index([specs], map: "idx_product_specs", type: Gin)
}

model Coupon {
  id         String    @id @default(cuid())
  storeName  StoreName
  title      String
  code       String
  expiryDate DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  products   Product[]

  @@unique([storeName, code])
  @@index([expiryDate])
}

model WebSearchCache {
  id        String                @id @default(uuid())
  query     String
  response  Json
  embedding Unsupported("vector")
  createdAt DateTime              @default(now())
}

enum StockStatus {
  IN_STOCK
  OUT_OF_STOCK
}

enum StoreName {
  XCITE
  BEST_KW
  NOON_KW
  EUREKA
  HM
  DIESEL
}
